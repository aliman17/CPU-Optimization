#!/bin/bash
# Compile combine
combine=combine # name of the compiled file
g++ combine.c -o combine -fno-tree-vectorize -mno-abm

# Run Matrix multiplication, extract measured cycles with
# grep (extracts all numbers from the input)
# head (head returns first line of the input)
# Do that for 15 values and append to the file result.txt
output=performanceResult.txt

rm $output 2>/dev/null  # remove output if it exists

power=16
for i in {1..18}
do
	echo Power is $(($i+3)) and number is $power >> $output
	average=0
	for i in {1..2}
	do
		./$combine $power>>$output # | grep -Eo '[0-9]+\.[0-9]*' | head -1 >> $output
	done
	power=$(($power*2))
done

cat $output
